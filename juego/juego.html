<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird Personalizado - Phaser 3</title>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #70c5ce;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #gameContainer {
      width: 100%;
      max-width: 964px;
      aspect-ratio: 16 / 9;
      border: 3px solid #fff;
      border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,0,0,0.4);
      overflow: hidden;
    }

    canvas {
      image-rendering: pixelated;
      display: block;
      width: 100% !important;
      height: 100% !important;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
  <div id="gameContainer"></div>

  <script>
    const WIDTH = Math.min(window.innerWidth, 964);
    const HEIGHT = Math.floor(WIDTH * 9 / 16);

    class MainScene extends Phaser.Scene {
      constructor() { super('MainScene'); }

      preload() {
        this.load.image('fondo', 'fondo.png');
        this.load.image('bird', 'pajaro.png');
      }

      create() {
        const bg = this.add.image(WIDTH / 2, HEIGHT / 2, 'fondo');
        bg.setDisplaySize(WIDTH, HEIGHT);

        const g = this.add.graphics();
        g.fillStyle(0x3bb54a, 1);
        g.fillRect(0, 0, 80, 600);
        g.fillStyle(0x2f8a3a, 1);
        g.fillRect(0, 0, 80, 24);
        g.generateTexture('pipe', 80, 600);
        g.clear();

        g.fillStyle(0x8b5a2b, 1);
        g.fillRect(0, 0, WIDTH, 64);
        g.generateTexture('ground', WIDTH, 64);
        g.clear();

        this.physics.world.setBounds(0, 0, WIDTH, HEIGHT);

        this.bird = this.physics.add.sprite(80, HEIGHT / 2, 'bird');
        this.bird.setCollideWorldBounds(true);
        this.bird.setGravityY(850);
        this.bird.setOrigin(0.5);

        const scaleFactor = Math.min(120 / this.bird.width, 70 / this.bird.height);
        this.bird.setScale(scaleFactor);

        this.ground = this.physics.add.staticImage(WIDTH / 2, HEIGHT - 32, 'ground');
        this.ground.visible = false;

        this.pipes = this.physics.add.group();

        this.input.on('pointerdown', this.flap, this);
        this.input.keyboard.on('keydown-SPACE', this.flap, this);

        this.pipeTimer = this.time.addEvent({
          delay: 1300,
          callback: this.spawnPipes,
          callbackScope: this,
          loop: true
        });

        this.physics.add.collider(this.bird, this.pipes, this.onGameOver, null, this);
        this.physics.add.collider(this.bird, this.ground, this.onGameOver, null, this);

        this.isAlive = true;

        this.instruction = this.add.text(WIDTH / 2, HEIGHT / 2 - 40, 'Toca o presiona ESPACIO para volar', {
          font: '18px Arial', fill: '#fff'
        }).setOrigin(0.5);
      }

      flap() {
        if (!this.isAlive) {
          this.scene.restart();
          return;
        }

        this.bird.setVelocityY(-330);
        this.tweens.killTweensOf(this.bird);

        this.tweens.add({
          targets: this.bird,
          angle: -20,
          duration: 80,
          ease: 'Power0'
        });

        if (this.instruction) {
          this.instruction.destroy();
          this.instruction = null;
        }
      }

      spawnPipes() {
        if (!this.isAlive) return;

        const gap = 150;
        const topMin = 80;
        const bottomMin = 80;
        const maxTop = HEIGHT - gap - bottomMin - 64;

        const topHeight = Phaser.Math.Between(topMin, Math.max(topMin, maxTop));
        const x = WIDTH + 40;

        const topPipe = this.pipes.create(x, topHeight / 2, 'pipe');
        topPipe.displayHeight = topHeight;
        topPipe.displayWidth = 80;
        topPipe.body.allowGravity = false;
        topPipe.setImmovable(true);
        topPipe.setVelocityX(-180);
        topPipe.flipY = true;

        const bottomHeight = (HEIGHT - 64) - topHeight - gap;
        const bottomY = topHeight + gap + bottomHeight / 2;
        const botPipe = this.pipes.create(x, bottomY, 'pipe');
        botPipe.displayHeight = bottomHeight;
        botPipe.displayWidth = 80;
        botPipe.body.allowGravity = false;
        botPipe.setImmovable(true);
        botPipe.setVelocityX(-180);
      }

      update() {
        if (!this.isAlive) return;

        if (this.bird.body.velocity.y > 0) {
          const t = Phaser.Math.Clamp(this.bird.body.velocity.y / 600, 0, 1);
          this.bird.angle = Phaser.Math.Linear(-20, 60, t);
        }

        if (this.bird.y < -50) {
          this.onGameOver();
        }
      }

      onGameOver() {
        if (!this.isAlive) return;
        this.isAlive = false;

        this.pipes.getChildren().forEach(p => {
          if (p.body) p.body.setVelocityX(0);
        });
        this.pipeTimer.remove(false);

        this.add.text(WIDTH / 2, HEIGHT / 2 - 10, 'Â¡Fin del juego!', {
          font: '32px Arial', fill: '#fff'
        }).setOrigin(0.5);
        this.add.text(WIDTH / 2, HEIGHT / 2 + 30, 'Toca para reiniciar', {
          font: '18px Arial', fill: '#fff'
        }).setOrigin(0.5);

        this.bird.setVelocityY(250);
        this.tweens.add({
          targets: this.bird,
          angle: 90,
          duration: 600,
          ease: 'Power1'
        });
      }
    }

    const config = {
      type: Phaser.AUTO,
      width: WIDTH,
      height: HEIGHT,
      parent: 'gameContainer',
      physics: { default: 'arcade', arcade: { debug: false } },
      scene: [MainScene],
      scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH }
    };

    const game = new Phaser.Game(config);

    window.addEventListener('resize', () => {
      const newWidth = Math.min(window.innerWidth, 964);
      const newHeight = Math.floor(newWidth * 9 / 16);
      game.scale.resize(newWidth, newHeight);
    });
  </script>
</body>
</html>
